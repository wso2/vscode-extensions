{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Arazzo",
  "scopeName": "source.arazzo",
  "patterns": [
    { "include": "#comments" },
    { "include": "#arazzo-version" },
    { "include": "#info-object" },
    { "include": "#source-descriptions" },
    { "include": "#workflows" },
    { "include": "#components" },
    { "include": "#keywords" },
    { "include": "#runtime-expressions" },
    { "include": "#strings" },
    { "include": "#numbers" },
    { "include": "#booleans" },
    { "include": "#null" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "comment": "YAML comments - must be at start of line or preceded by whitespace",
          "name": "comment.line.number-sign.arazzo",
          "match": "(?:^\\s*|\\s+)(#.*)$",
          "captures": {
            "1": { "name": "comment.line.number-sign.arazzo" }
          }
        }
      ]
    },
    "arazzo-version": {
      "patterns": [
        {
          "name": "keyword.control.arazzo.version",
          "match": "^\\s*(arazzo)\\s*:",
          "captures": {
            "1": { "name": "keyword.control.arazzo" }
          }
        }
      ]
    },
    "info-object": {
      "patterns": [
        {
          "name": "entity.name.tag.arazzo.info",
          "match": "^\\s*(info|title|summary|description|version)\\s*:",
          "captures": {
            "1": { "name": "keyword.other.arazzo.info" }
          }
        }
      ]
    },
    "source-descriptions": {
      "patterns": [
        {
          "name": "entity.name.tag.arazzo.source",
          "match": "^\\s*(sourceDescriptions|name|url|type)\\s*:",
          "captures": {
            "1": { "name": "keyword.other.arazzo.source" }
          }
        }
      ]
    },
    "workflows": {
      "patterns": [
        {
          "name": "entity.name.tag.arazzo.workflow",
          "match": "^\\s*(workflows|workflowId|summary|description|inputs|steps|outputs|parameters|dependsOn|successCriteria|onSuccess|onFailure)\\s*:",
          "captures": {
            "1": { "name": "keyword.other.arazzo.workflow" }
          }
        },
        {
          "name": "entity.name.tag.arazzo.step",
          "match": "^\\s*(stepId|operationId|operationPath|workflowId|requestBody|successCriteria|onSuccess|onFailure|outputs)\\s*:",
          "captures": {
            "1": { "name": "keyword.other.arazzo.step" }
          }
        }
      ]
    },
    "components": {
      "patterns": [
        {
          "name": "entity.name.tag.arazzo.component",
          "match": "^\\s*(components|inputs|parameters|successActions|failureActions)\\s*:",
          "captures": {
            "1": { "name": "keyword.other.arazzo.component" }
          }
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.other.arazzo",
          "match": "\\b(type|name|in|value|target|expression|reference|condition|context|type|retryAfter|retryLimit)\\b"
        }
      ]
    },
    "runtime-expressions": {
      "patterns": [
        {
          "name": "variable.other.arazzo.runtime-expression",
          "match": "\\$(url|method|statusCode|request\\.(header|query|body|path)|response\\.(header|query|body)|inputs|steps|workflows|sourceDescriptions|components)[\\.\\w\\[\\]'\"]*",
          "captures": {
            "0": { "name": "variable.other.arazzo.runtime" }
          }
        },
        {
          "name": "support.function.arazzo.criterion",
          "match": "\\$statusCode\\s*(==|!=|<|>|<=|>=)\\s*\\d+"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "comment": "Double-quoted strings - match after colon, dash, or at start of line",
          "name": "string.quoted.double.arazzo",
          "begin": "(?:^|:\\s*|(?<=\\s)-\\s*)\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.arazzo",
              "match": "\\\\."
            },
            { "include": "#runtime-expressions" }
          ]
        },
        {
          "comment": "Single-quoted strings - match after colon, dash, or at start of line",
          "name": "string.quoted.single.arazzo",
          "begin": "(?:^|:\\s*|(?<=\\s)-\\s*)'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.arazzo",
              "match": "\\\\."
            },
            { "include": "#runtime-expressions" }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.arazzo",
          "match": "\\b-?[0-9]+(\\.[0-9]+)?([eE][+-]?[0-9]+)?\\b"
        }
      ]
    },
    "booleans": {
      "patterns": [
        {
          "name": "constant.language.boolean.arazzo",
          "match": "\\b(true|false)\\b"
        }
      ]
    },
    "null": {
      "patterns": [
        {
          "name": "constant.language.null.arazzo",
          "match": "\\bnull\\b"
        }
      ]
    }
  }
}
